---
title: "R Notebook"
output: html_notebook
---

## Project Description

## Why did we choose this project?


## Data
The dataset ... too include(Brazil, state of Espirito Santo - Public Sector - Primary Care)
*Description of the dataset*
- Age: Age of the patient
- Gender: Gender of the patient
- AppointmentRegistration: Time and date when the patient took the appointment
- AppointmentData: Date of the appointment
- Diabetes: Is the patient affected by diabetes? (0/1)
- Alcoolism: is the patient alcoolic? (0/1)
- Hipertension: Is the patient affected by hypertension? (0/1)
- Handcap: 
- Smokes: Is the patient smoking? (0/1)
- Scholarship: Is the patient receiving a scholarship? Those scholarships are given by Bolsa Familia to low income families who accept to send their kids to school nd have them vaccinated. 
- Tuberculosis: Is the patient affected by tuberculosis? (0/1)
- AwaitingTime: How many days the patient waited between the appointment registration and the date of the appointment
- Status: Did the patient show-up or not? (No-Show/Show-Up)
*Source*

## Exploratory Data Analysis

**Step 0: Load Packages**

```{r}
library(plyr)
library(dplyr)
library(ggplot2)
```

**Step 1: Load Dataset**
```{r}
dataset <- read.csv("../data/No-show-Issue-Comma-300k.csv")
```

**Step 2: Clean & Organize dataset**
```{r}
# Check Format
str(dataset)
```

```{r}
# Update Columns Names
colnames(dataset) <- c("age", "gender", "appointment_registration", 
                       "appointment_date", "dayofweek_apptmt", "show_up",
                       "diabetes", "alcoholism", "hypertension", "handicap", 
                       "smoker", "scholarship", "tuberculosis",
                       "sms_reminder", "daydiff_regist_appt")

# Update Columns Format
dataset$sms_reminder <- factor(dataset$sms_reminder)
dataset$diabetes <- factor(dataset$diabetes)
dataset$alcoholism <- factor(dataset$alcoholism)
dataset$hypertension <- factor(dataset$hypertension)
dataset$handicap <- factor(dataset$handicap)
dataset$smoker <- factor(dataset$smoker)
dataset$scholarship <- factor(dataset$scholarship)
dataset$tuberculosis <- factor(dataset$tuberculosis)
```

```{r}
# Check Values
summary(dataset)
```


```{r}
# Data Cleaning

# Age: The Age shouldn't be negative, we will remove those rows. 
dataset <- dataset[dataset$age>0,]

# Appointment day of the week: We don't know if this variable is linked to the registration date or the apointment date - we will delete it and use the raw columns only
dataset$dayofweek_apptmt <- NULL

# Number of days between registration time and appointment date: We will convert this value to be positive
dataset$daydiff_regist_appt <- -(dataset$daydiff_regist_appt)

# Show-up / No-Show: 
dataset$show_up <- revalue(dataset$show_up, c("No-Show"=0, "Show-Up"=1))

# clean dates and time:
## Appt Registration Date
dataset$appointment_registration = as.POSIXct(as.character(dataset$appointment_registration),"%Y-%m-%d T%H:%M:%SZ",tz = "Brazil/East")

dataset = mutate(dataset, weekday_registration = as.factor(format(dataset$appointment_registration,"%a")))
dataset = mutate(dataset, day_registration = as.numeric(as.integer(format(dataset$appointment_registration,"%d"))))
dataset = mutate(dataset, month_registration = as.numeric(format(dataset$appointment_registration,"%m")))
dataset = mutate(dataset, date_registration = as.numeric(format(dataset$appointment_registration,"%D")))
dataset = mutate(dataset, hour_registration = as.numeric(format(dataset$appointment_registration,"%H")))
dataset = mutate(dataset, minute_registration = as.numeric(format(dataset$appointment_registration,"%M")))
dataset = mutate(dataset, day_of_year_registration = as.numeric(format(dataset$appointment_registration,"%j")))
dataset = mutate(dataset, week_of_year_registration = as.numeric(format(dataset$appointment_registration,"%U")))
dataset = mutate(dataset, am_pm_registration = as.factor(format(dataset$appointment_registration,"%p")))

#Appt Actual Date
dataset$appointment_data = as.POSIXct(as.character(dataset$appointment_data),"%Y-%m-%d T%H:%M:%SZ",tz = "Brazil/East")

dataset = mutate(dataset, weekday_appointment = as.factor(format(dataset$appointment_data,"%a")))
dataset = mutate(dataset, day_appointment = as.numeric(as.integer(format(dataset$appointment_data,"%d"))))
dataset = mutate(dataset, month_appointment = as.numeric(format(dataset$appointment_data,"%m")))
dataset = mutate(dataset, date_appointment = as.numeric(format(dataset$appointment_data,"%D")))
dataset = mutate(dataset, day_of_year_appointment = as.numeric(format(dataset$appointment_data,"%j")))
dataset = mutate(dataset, week_of_year_appointment = as.numeric(format(dataset$appointment_data,"%U")))
```